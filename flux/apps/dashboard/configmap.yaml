---
apiVersion: v1
kind: ConfigMap
metadata:
  name: homepage
  namespace: dashboard
data:
  settings.yaml: |
    title: Homelab
    favicon: "https://raw.githubusercontent.com/pxldi/homelab/refs/heads/main/flux/apps/dashboard/resources/house-icon.png"
    theme: dark
    color: slate

    useEqualHeights: true

    headerStyle: clean
    hideVersion: true

    statusStyle: "dot"

    providers:
      finnhub: {{HOMEPAGE_VAR_FH_API_KEY}}

    layout:
      Row1:
        header: false
        style: row
        columns: 3
      Row2:
        header: false
        style: row
        columns: 4
      Row3:
        header: false
        style: row
        columns: 3
      Row4:
        header: false
        style: row
        columns: 4
      Row5:
        header: false
        style: row
        columns: 4
      Row6:
        header: false
        style: row
        columns: 2
  kubernetes.yaml: |
    mode: cluster
  widgets.yaml: |
    - logo:
        icon: "https://raw.githubusercontent.com/pxldi/homelab/refs/heads/main/flux/apps/dashboard/resources/house-icon.png"

    - greeting:
        text_size: 3x1
        text: Homelab

    - resources:
        cpu: true
        memory: true

    - resources:
        expanded: true
        disk:
          - /mnt/nvme
          - /mnt/hdd1
          - /mnt/hdd2

    - datetime:
        text_size: xl
        format:
          locale: de
          dateStyle: medium
          timeStyle: medium
          hourCycle: h23

    - openmeteo:
        label: {{HOMEPAGE_VAR_CITY_NAME_ENV}}
        latitude: {{HOMEPAGE_VAR_CITY_LATITUDE_ENV}}
        longitude: {{HOMEPAGE_VAR_CITY_LONGITUDE_ENV}}
        units: metric
        cache: 5
  services.yaml: |
    - Row1:
      - Traefik:
          icon: traefik.png
          href: https://traefik.pxldi.de
          ping: https://traefik.pxldi.de
          widget:
            type: traefik
            url: http://traefik.traefik:8080
      - Grafana:
          icon: grafana.png
          href: https://grafana.pxldi.de
          ping: https://grafana.pxldi.de
          widget:
            type: grafana
            version: 2
            url: http://kube-prometheus-stack-grafana.monitoring:80
            username: {{HOMEPAGE_VAR_GRAFANA_USER}}
            password: {{HOMEPAGE_VAR_GRAFANA_PASSWORD}}
      - Prometheus:
          icon: prometheus.png
          href: https://prometheus.pxldi.de
          ping: https://prometheus.pxldi.de
          widget:
            type: prometheus
            url: http://kube-prometheus-stack-prometheus.monitoring:9090

    - Row2:
      - Sabnzbd:
          icon: sabnzbd.png
          href: https://sabnzbd.pxldi.de
          ping: https://sabnzbd.pxldi.de
          widget:
            type: sabnzbd
            url: http://sabnzbd.media-stack:10097
            key: {{HOMEPAGE_VAR_SABNZBD_API_KEY}}
      - Sonarr:
          icon: sonarr.png
          href: https://sonarr.pxldi.de
          ping: https://sonarr.pxldi.de
          widget:
            type: sonarr
            url: http://sonarr.media-stack:8989
            key: {{HOMEPAGE_VAR_SONARR_API_KEY}}
      - Radarr:
          icon: radarr.png
          href: https://radarr.pxldi.de
          ping: https://radarr.pxldi.de
          widget:
            type: radarr
            url: http://radarr.media-stack:7878
            key: {{HOMEPAGE_VAR_RADARR_API_KEY}}
      - Jellyfin:
          icon: jellyfin.png
          href: https://jellyfin.pxldi.de
          ping: https://jellyfin.pxldi.de
          widget:
            type: jellyfin
            url: http://jellyfin.media-stack:8096
            key: {{HOMEPAGE_VAR_JELLYFIN_API_KEY}}

    - Row3:
      - Pihole:
          icon: pi-hole.png
          href: https://pihole.pxldi.de/admin/
          ping: https://pihole.pxldi.de/admin/
          widget:
            type: pihole
            url: http://pihole-web.pihole:80
            version: 6
      - Tandoor:
          icon: tandoor-recipes.png
          href: https://recipes.pxldi.de/
          ping: https://recipes.pxldi.de/
          widget:
            type: tandoor
            url: http://tandoor.tandoor:80
            key: {{HOMEPAGE_VAR_TANDOOR_API_KEY}}
      - Nextcloud:
          icon: nextcloud.png
          href: https://nextcloud.pxldi.de/
          ping: https://nextcloud.pxldi.de/
          widget:
            type: nextcloud
            url: https://nextcloud.pxldi.de
            key: {{HOMEPAGE_VAR_NEXTCLOUD_API_KEY}}
            fields: ["freespace", "activeusers", "numfiles", "numshares"]

    - Row4:
      - Homelab Repo:
          icon: github.png
          href: https://github.com/pxldi/homelab
      - FluxCD Docs:
          icon: flux-cd.png
          href: https://fluxcd.io/flux/
      - Cloudflare Dashboard:
          icon: cloudflare.png
          href: https://dash.cloudflare.com
      - Dashboard Icons:
          icon: dashboard-icons.png
          href: https://dashboardicons.com/

    - Row5:
      - HomeAssistant:
          icon: home-assistant.png
      - Kavita:
          icon: kavita.png
      - SearXNG:
          icon: searxng.png
      - Overleaf:
          icon: overleaf.png

    - Row6:
      - Stocks:
          icon: google-finance.png
          widget:
            type: stocks
            provider: finnhub
            watchlist:
              - NVDA
              - AAPL
              - MSFT
              - AMZN
              - AMD
      - Crypto:
          icon: bitcoin.png
          widget:
            type: coinmarketcap
            currency: USD
            symbols: [BTC, ETH, XRP, SOL, DOGE]
            key: {{HOMEPAGE_VAR_CMC_API_KEY}}
            defaultinterval: 7d

  bookmarks.yaml: ""
  docker.yaml: ""
  custom.css: |
    /* gradient background */
    #page_container {
      background:
        radial-gradient(ellipse at 20% 20%, rgba(30, 64, 115, 0.4) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(45, 30, 80, 0.3) 0%, transparent 50%),
        linear-gradient(160deg, #050810 0%, #0c1929 30%, #152238 50%, #0c1929 70%, #050810 100%) !important;
      min-height: 100vh;
    }

    /* Modern card styling with strong depth */
    .service-card, .service {
      background: rgba(15, 25, 45, 0.95) !important;
      border: 1px solid rgba(80, 100, 130, 0.3) !important;
      border-radius: 14px !important;
      backdrop-filter: blur(10px) !important;
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.6),
        0 2px 8px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03) !important;
      transition: all 0.25s ease !important;
    }

    .service-card:hover, .service:hover {
      background: rgba(25, 40, 65, 0.98) !important;
      border-color: rgba(100, 130, 170, 0.4) !important;
      transform: translateY(-3px) !important;
      box-shadow:
        0 16px 48px rgba(0, 0, 0, 0.7),
        0 8px 16px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
    }

    /* Widget cards */
    .widget {
      background: rgba(15, 25, 45, 0.9) !important;
      border: 1px solid rgba(80, 100, 130, 0.25) !important;
      border-radius: 12px !important;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5) !important;
    }

    /* Header bar styling */
    #information-widgets {
      background: rgba(15, 23, 42, 0.9) !important;
      border-bottom: 1px solid rgba(71, 85, 105, 0.3) !important;
      backdrop-filter: blur(12px) !important;
    }

    /* Main container with consistent spacing */
    #widgets-wrap {
      display: flex !important;
      align-items: center !important;
      width: 100% !important;
      padding: 0 1rem !important;
      gap: 0 !important;
    }

    /* Logo and greeting close together */
    .information-widget-logo {
      margin-right: 0.75rem !important;
    }

    .information-widget-greeting {
      margin-right: 3rem !important;
      font-size: 1.5rem !important;
      font-weight: 600 !important;
      color: #e2e8f0 !important;
      -webkit-text-fill-color: #e2e8f0 !important;
      letter-spacing: 0.02em !important;
    }

    /* Resource containers with proper spacing */
    .widget-container:has(.information-widget-resource) {
      display: flex !important;
      margin-right: 2rem !important;
    }

    .widget-container:has(.information-widget-resource) > div {
      display: flex !important;
      gap: 1rem !important;
    }

    /* Individual resource items */
    .information-widget-resource {
      margin: 0 !important;
    }

    /* Datetime/weather with consistent spacing */
    #information-widgets-right {
      margin-left: 3rem !important;
      display: flex !important;
      gap: 2rem !important;
    }

    /* Clean text colors */
    .text-theme-700 {
      color: #cbd5e1 !important;
    }

    .text-theme-500 {
      color: #94a3b8 !important;
    }

    /* Status dots */
    .status-dot {
      box-shadow: 0 0 8px currentColor !important;
    }

  custom.js: |
    const RELOAD_BUTTON_SELECTORS = [
      "#revalidate",
      '[data-testid="revalidate"]',
      ".reload-button",
      'button[aria-label="Reload"]',
    ];

    function removeReloadButton() {
      RELOAD_BUTTON_SELECTORS.forEach((selector) => {
        document.querySelectorAll(selector).forEach((el) => el.remove());
      });
    }

    function setupReloadButtonObserver() {
      const observer = new MutationObserver(() => removeReloadButton());
      observer.observe(document.body, {
        childList: true,
        subtree: true,
      });
      return observer;
    }

    document.addEventListener("DOMContentLoaded", removeReloadButton);
    window.addEventListener("load", () => {
      removeReloadButton();
      setupReloadButtonObserver();
      [100, 500, 1000].forEach((delay) => setTimeout(removeReloadButton, delay));
    });
